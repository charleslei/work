<! doctype html>
<html>
<head>
	<style type="text/css">
		body{overflow: hidden;}
		.prt{width: 100%; background: white;}
		.content{width: 990px;margin: 0 auto;border:1px solid #999;min-height: 800px;margin-top: 100px;}

		.popup{
			position: absolute;
			left: 0;
			top: 0;
			width: 500px;
			height: 200px;
			display: none;
			background: green;
		}
	</style>
</head>
<body>
	<div class="prt">
		<div class='content'>
			<span>这是一个历史性的时刻，</span><a id="todopup1" href='javascript:;' >this is a test</a><span>连接了两国人民。两国有相同的语言，克里米亚绝大多数是俄罗斯族，他们需要加入俄罗斯。这是克里米亚人的权利，我们尊重他们的权利，他们拥有着和俄罗斯一样的权利和地位。克里米亚现在的军事局势，要求我们必须答应他们的要求，这是公投的结果，形成这样的请求是公开公正的。
大家应该知道克里米亚对俄罗斯意味着什么。克里米亚与俄罗斯太相像，有许多不同种族的人在那里居住。克里米亚公投符合国际标准。克里米亚是黑海舰队的家乡。克里米亚是俄罗斯神圣的领土。
我发誓保护在克里米亚的鞑靼人。俄罗斯、乌克兰和鞑靼语是克里米亚的官方语言。今天的决定具有历史重要意义，如果你了解历史，就完全可以理解克里米亚人民的决定。我们不能将克里米亚人弃之不顾，那样的话我们就成了叛徒。
我明白为什么乌克兰人希望改变，他们厌倦了政治和权力。我们知道乌克兰没有执行政府，现在的乌克兰政府在激进份子的控制下。乌克兰的俄罗斯族人已经受够了乌克兰政府。</span><a id="todopup" href='javascript:;' >this is a test</a>
			
		</div>
	</div>
	<script type="text/javascript" src="./jquery-2.1.0.min.js"></script>
	<script type="text/javascript">

	(function($, win, doc){
		function popup(config){
			var me = $(this);
			var cfg = {origin: me};
			//var cfg = $(}, config); 这是错误的用法；
			$.extend(cfg, config);
			new pp(cfg);
		}

		function pp(config){
			var prms = {
				origin: '',
				evt: 'mouseover',
				parent: 'body',
				position: 'lb'
			};
			$.extend(prms, config);
			this.params = prms;
			this._init();

		}
		pp.prototype = {
			_init: function(){
				var me = this;
				var origin = this.params.origin;
				var evt = this.params.evt;
				this._drawHTML();
				me.rect = {};
				origin.bind(evt, function(e){
					me.params.cursorPosition = {x: e.pageX, y: e.pageY};
					me._showWin();
				});
				origin.bind('mouseout', function(e){
					me._hideWin();
				});


			},
			_drawHTML: function(){
				var _html = '<div class="popup"></div>';
				var obj = $(_html);
				this.params.popupWin = obj;
				$(this.params.parent).append(obj);
			},

			//show popup window;
			_showWin: function(){
				var me = this;
				/*
				显示位置的说明：
				1、默认弹框左上角与触发元素的左下角重合；左右自适应；
				2、可设置的值有：
					a：left；弹框右上角与触发元素左上角重合；
					b：top；弹窗左下角与触发元素左上角重合；
					c：right；弹窗左上角与触发元素右上角重合；
					d：bottom；与默认设置相同；
					e：mouse；弹窗左上角为鼠标位置；左右位置可自适应；
				*/

				var po = me._getPosition(me.params.position);
				me.params.popupWin.css('left', po.x).css('top', po.y).show();
			},

			_hideWin: function(){
				var me = this;
				me.params.popupWin.hide();
			},

			_getPosition: function(po){
				var me = this;
				var pts = {
					lt: 'LEFTTOP',
					rt: 'RIGHTTOP', 
					rb: 'RIGHTBOTTOM', 
					lb: 'LEFTBOTTOM', 
					l: 'LEFT',
					t: 'TOP',
					r: 'RIGHT',
					b: 'BOTTOM',
					cur: 'CURSOR'}; //左上，右上，右下，左下

				return me._getPositionExec(pts[po]);
			},

			_getPositionExec: function(dir){ //获取弹窗的左上角；原则是弹窗不能压盖触发元素；
				
				var x = '', y = '';
				var me = this;
				var origin = me.params.origin;
				var oW = origin.width();
				var oH = origin.height();
				var lt = origin.offset();
				var popupWin = me.params.popupWin;
				var pW = popupWin.width();
				var pH = popupWin.height();
				var cp = me.params.cursorPosition;

				switch (dir){
					case 'LEFT':
						x = lt.left - pW;
						y = lt.top;
						break;
					case 'TOP':
						x = lt.left;
						y = lt.top - pH;
						break;
					case 'RIGHT':
						x = lt.left + oW;
						y = lt.top;
						break;
					case 'BOTTOM':
						x = lt.left;
						y = lt.top + oH;
						break;
					case 'LEFTTOP': 
						x = lt.left - pW;
						y = lt.top - pH;
						break;
					case 'RIGHTTOP': 
						x = lt.left + oW;
						y = lt.top;						
						break;
					case 'RIGHTBOTTOM': 
						x = lt.left + oW;
						y = lt.top + oH;
						break;
					case 'LEFTBOTTOM': 
						x = lt.left;
						y = lt.top + oH;
						break;
					case 'CURSOR'://2px的缓冲；
						x = cp.x + 2;
						y = cp.y + 2;
						break;
					default: //左上；
						x = lt.left;
						y = lt.top + oH;
						dir = 'BOTTOM';
						break;
				}
				$.extend(me.rect, {x: x, y: y, w: pW, h: pH});
				me._adjustBottomPostion(me.rect, dir);
				return {x: me.rect.x + 'px', y: me.rect.y + 'px'}
			},

			_adjustBottomPostion: function(rect, dir){
				var me = this;
				//获取文档的宽度/高度；
				var dH = $(document).height();
				var dW = $(document).width();

				//获取窗口的高度/宽度；
				var wH = $(window).height();
				var wW = $(window).width();

				var x = rect.x;
				var y = rect.y;
				var w = rect.w;
				var h = rect.h;

				(w <= dW) && (x + w > dW) && (rect.x = dW - w); //popup宽度大于文档宽度时，不处理了；
				//左侧超限，按照下面的方式考虑；右-> 下 -> 左 -> 上；
				(w <= dW) && (x < 0) && (me._getPositionExec(me._nextDirect(dir))); 
				(h <= dH) && (y < 0) && (me._getPositionExec(me._nextDirect(dir))); 
				//(h <= dH) && (y + h > dH) && ()
			},

			_nextDirect: function(current){//TODO:循环一遍就跳出；
				var dirs = ['RIGHT', 'BOTTOM', 'LEFT', 'TOP'];
				var idx = dirs.indexOf(current) + 1;
				(idx === dirs.length) && (idx = 0);
				return dirs[idx];
			}



		};

		$.fn.PopUp = popup;

	})(jQuery, window, document);

	$('#todopup').PopUp({position: 'l'});
	$('#todopup1').PopUp({position: 'l'});
	</script>
</body>
</html>